// --------------------------------------
// Order Model
// --------------------------------------

model Order {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id])

  // Relations: Changed from embedded type to One-to-Many model
  items OrderItem[]

  total         Float
  status        String  @default("pending")
  address       String?
  
  paymentMethod String?
  paymentStatus String? @default("pending")
  paymentIntentId String? //from stripe 

  createdAt DateTime @default(now())
  arriveAt DateTime

  updatedAt DateTime @updatedAt

  @@map("Orders")
}

model OrderItem {
  id      String @id @default(uuid())
  orderId String
  order   Order  @relation(fields: [orderId], references: [id], onDelete: Cascade)

  variantId String
  variant   ProductVariant @relation(fields: [variantId], references: [id])

  quantity Int
  snapshotPrice    Float
  
  @@unique([orderId, variantId])
  @@map("OrderItems")
}
